Смотри, на верхнем уровне это выглядит как **двухэтажная схема**:

1. Сначала мы превращаем набор из 20–50 «10-уровневых» позиций в **структурированную карту практики**.
2. Потом из этой карты собираем один человеческий документ — **обзор судебной практики**.

Разложу это по шагам и набросаю, как выглядит верхнеуровневый prompt.

---

## 1. Верхнеуровневый pipeline

### Шаг 0. Входные данные

У тебя есть N дел, и по каждому:

* идентификатор дела (№, суд, дата, инстанция),
* предмет спора / правовой вопрос,
* 10 уровней правовой позиции (уже размеченных моделью).

**Цель:** не просто «суммировать всё подряд», а получить:

* общие подходы судов,
* точки расхождения,
* тенденции,
* практические выводы для юриста.

---

### Шаг 1. Локальное сжатие по каждому делу

**Задача:** для каждого дела сделать короткий, но жёстко структурированный summary, чтобы дальше работать не с «сырыми» 10 уровнями, а с компактной карточкой.

Для каждого дела модель делает, например:

* 1–2 строки: «Краткая фабула и предмет спора»
* 3–5 буллетов: «Ключевые правовые выводы» (из 10 уровней)
* 1–2 строки: «Применённые нормы»
* 1 строка: «Результат (исковое требование удовлетворено/отказано/частично)»

**Выход:** набор «карточек дел», где каждая карточка — компактная выжимка 10 уровней.

---

### Шаг 2. Группировка по правовым вопросам

Если у тебя обзоров несколько, то:

* Либо у тебя заранее один правовой вопрос (тогда этот шаг формальный).
* Либо у тебя разные вопросы — тогда:

  * кластеризуешь карточки по **ключевому правовому вопросу**, нормам, типу спора,
  * внутри каждого кластера дела более-менее про одно и то же.

**Выход:** 1 кластер = 1 будущий обзор судебной практики по конкретному вопросу.

---

### Шаг 3. Агрегация внутри кластера (самое важное место магии)

Для кластера (например, 20 дел по одному вопросу) модель должна построить:

* **Матрицу подходов**:

  * Подход 1 (большинство): как формулирует критерии, как толкует норму.
  * Подход 2 (миноритарный): при каких фактических нюансах суды идут в другую сторону.
* **Перекрёстное сравнение**:

  * чем отличаются условия (факты), где суд принимает иной подход;
  * какие инстанции/периоды склоняются к какому подходу.
* **Выводы по трендам**:

  * есть ли смещение во времени;
  * есть ли «жёсткая линия» верховных судов.

Здесь модель работает уже **не как summarizer, а как аналитик**: ищет повторяющиеся мотивы, различия, типовые конструкции.

**Выход:** структурированный «скелет обзора»:

* Список подходов (Подход А, Подход B),
* Для каждого — перечень дел-примеров,
* Тенденции и расхождения,
* Нормативная база, которая реально «работает» в практике.

---

### Шаг 4. Генерация финального документа «Обзор судебной практики»

На основе «скелета» модель пишет уже **читаемый текст** со структурой, привычной для юристов. Например:

1. **Введение**

   * Кратко: о чём спор, почему вопрос важен.
2. **Нормативная база и общий контекст**

   * Какие статьи, какие подзаконные акты фигурируют.
3. **Подходы судов**

   * Подход 1 (основной)

     * описание сути подхода, критерии, типичные факты;
     * 2–3 ключевых дела как иллюстрации.
   * Подход 2 (альтернативный/миноритарный)

     * в каких случаях применяется, примеры.
4. **Тенденции и практика высших судов**

   * если есть позиция ВС/КС — где и как «обрезает» варианты.
5. **Практические выводы для юристов**

   * «Что делать истцу», «что делать ответчику», «как формулировать требования / возражения».

**Выход:** готовый обзор, который можно:

* отдать клиенту,
* встроить в продукт как аналитику,
* использовать как тренинг-материал.

---

## 2. Верхнеуровневый дизайн prompt’а

На уровне общей конструкции prompt должен быть **двухслойным**:

1. Prompt для **агрегации** (из карточек дел → «скелет обзора»).
2. Prompt для **написания текста обзора** (из «скелета» → законченный документ).

Ниже именно верхний уровень, без тонкой настройки.

---

### 2.1. Prompt для агрегации (из 20–50 позиций → карта подходов)

**Роль / контекст:**

* «Ты опытный юрист-аналитик / судья, который готовит обобщение судебной практики для методических рекомендаций.»

**Вход:**

* список дел, и для каждого:

  * краткая фабула,
  * ключевой правовой вопрос,
  * краткие правовые выводы (из 10 уровней),
  * результат, инстанция, дата.

**Инструкция верхнего уровня:**

1. Определи, какие **правовые подходы** можно выделить (1, 2, максимум 3).
2. Для каждого подхода:

   * сформулируй его **суть простым языком**,
   * укажи, при каких фактах он применяется,
   * перечисли дела, которые его иллюстрируют.
3. Опиши **расхождения** между подходами:

   * в толковании нормы,
   * в требованиях к доказательствам,
   * в оценке отдельных фактов.
4. Сформулируй **тенденции**:

   * какой подход доминирует,
   * есть ли сдвиги во времени,
   * есть ли роль верховных судов.

**Формат ответа (примерно):**

* Правовой вопрос: …
* Нормативная база: …
* Подход 1: … (перечень дел)
* Подход 2: … (перечень дел)
* Расхождения: …
* Тенденции: …

---

### 2.2. Prompt для финального обзора (из «карты» → текст)

**Роль / контекст:**

* «Ты юрист-аналитик, пишешь обзор судебной практики для практикующих юристов и внутренней базы знаний.»

**Вход:**

* Структурированный «скелет»:

  * формулировка правового вопроса,
  * перечень норм,
  * описание подходов,
  * расхождения и тенденции,
  * привязка дел к подходам.

**Инструкция верхнего уровня:**

1. Напиши связный **обзор судебной практики** с чёткой структурой разделов:

   * Введение,
   * Нормативная база,
   * Подходы судов,
   * Тенденции и позиция высших судов,
   * Практические рекомендации.
2. Не пересказывай каждое дело по отдельности, используй дела **как иллюстрации**:

   * «В деле А суд указал, что…»
3. Отдельно выдели **практические выводы**:

   * что важно указать в иске/отзыве,
   * какие доказательства критичны,
   * где есть риск, что суд пойдёт по альтернативному подходу.
4. Избегай излишней теории и ссылок на нормы «ради ссылок» — показывай, **как норма реально применяется**.

**Формат ответа:**

Готовый текст 3–7 страниц в зависимости от глубины (можно регулировать ограничением по tokens / «не более X символов»).

